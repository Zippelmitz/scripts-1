#!/usr/bin/env perl
#
# Creates a local installation of CPAN modules and runs CPAN shell properly
# configured to use it
#

use strict;
use warnings;

my ($name) = @ARGV;

if (!$name) {
  usage();
  exit(2);
}

if ($name !~ /^[a-zA-Z0-9_.-]+$/) {
  fatal(
    "name of local repo is invalid - '$name'",
    "Must be composed of letters, numbers, dash, dot, and underscore",
  );
}




###########
# Utilities

sub load_cpan_config {
  my @dirs_to_search;
  
  eval {
    require File::HomeDir;
    push @dirs_to_search, File::HomeDir->my_data;
    push @dirs_to_search, File::HomeDir->my_home;
  };    
  push @dirs_to_search, $ENV{HOME};
  
  unshift @INC, grep { $_ } @dirs_to_search;
  
  eval { require CPAN::MyConfig };
  eval { require CPAN::Config } unless $INC{'CPAN/MyConfig.pm'};
  
  # As a default, use an empty config
  # We will fill the details later
  # $CPAN::Config ||= {};
}


sub usage {
  print <<"  USAGE";
Usage: x-cpan-local NAME

Creates a local directory to install modules named `NAME`.
Add `$ENV{HOME}/.my_perl_lib/NAME` to your lib to use.

  USAGE
}

sub fatal {
  my ($msg, @extra) = @_;
  
  print "FATAL: $msg\n";
  foreach my $extra (@extra) {
    print "    $extra\n";
  }
  exit(1);
}
